<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: console_script2.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: console_script2.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import fs from 'fs-extra';
import readLine from 'readline';
import { exec } from 'node:child_process';


/** Path to file witch stores number of script runs */
const filePath = 'counter.txt';

/** Synchronously read value from file counter.txt */
function readCounterSync() {
  try {
    const counter = fs.readFileSync(filePath, 'utf8');
    return parseInt(counter);
  } catch (err) {
    if (err.code === 'ENOENT') {
      // File doesn't exist yet, so return 0
      return 0;
    } else {
      throw err;
    }
  }
}

/** Synchronously write value to file counter.txt 
 * @param {int} counter - value from file counter.txt
*/
function writeCounterSync(counter) {
  fs.writeFileSync(filePath, counter.toString());
}

/** Asynchronously read value from file counter.txt */
function readCounterAsync() {
  return new Promise((resolve, reject) => {
    fs.readFile(filePath, 'utf8', (err, data) => {
      if (err) {
        if (err.code === 'ENOENT') {
          // File doesn't exist yet, so resolve with 0
          resolve(0);
        } else {
          reject(err);
        }
      } else {
        const counter = parseInt(data);
        resolve(counter);
      }
    });
  });
}

/** Asynchronously write value to file counter.txt 
 * @param {int} counter - value from file counter.txt
*/
function writeCounterAsync(counter) {
  return new Promise((resolve, reject) => {
    fs.writeFile(filePath, counter.toString(), (err) => {
      if (err) {
        reject(err);
      } else {
        resolve();
      }
    });
  });
}

/** Main function  */
async function run() {
    const option = process.argv[2];
    let readCounter, writeCounter;
    if (option === "--sync") {
        readCounter = readCounterSync;
        writeCounter = writeCounterSync;
    } else if (option === "--async") {
        readCounter = readCounterAsync;
        writeCounter = writeCounterAsync;
    } else {
        /**Execute system function from stdin */
        const rl = readLine.createInterface({
          input: process.stdin,
          output: process.stdout,
      });
      for await (const command of rl) {
          exec(command, (err, stdout, stderr) => {
              if (err) {
                  console.log(`error: ${err.message}`);
                  return;
              }
              if (stderr) {
                  console.log(`stderr: ${stderr}`);
                  return;
              }
              console.log(`stdout: ${stdout}`);
        });
      }
      return;
  }

  /** Read value from counter and then increment it and write new value to file */
  let counter = await readCounter();
  console.log(`Counter: ${counter}`);
  counter++;
  writeCounter(counter);
  console.log("Counter updated.");
}

/** Handle error while run script */
run().catch((err) => {
  console.error(err);
  process.exit(1);
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#filePath">filePath</a></li><li><a href="global.html#readCounterAsync">readCounterAsync</a></li><li><a href="global.html#readCounterSync">readCounterSync</a></li><li><a href="global.html#run">run</a></li><li><a href="global.html#writeCounterAsync">writeCounterAsync</a></li><li><a href="global.html#writeCounterSync">writeCounterSync</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Wed Apr 19 2023 12:21:34 GMT+0200 (czas Å›rodkowoeuropejski letni)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
